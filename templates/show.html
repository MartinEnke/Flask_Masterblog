<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Show</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<script>
  function likePost(event, postId) {
    event.preventDefault(); // Prevent form from submitting

    fetch(`/like/${postId}`, {
      method: "POST"
    })
    .then(response => response.json())
    .then(data => {
      // Update like count visually
      document.getElementById(`like-count-${postId}`).textContent = data.likes;

      // Optional: flash effect
      const postElement = document.getElementById(`post-${postId}`);
      if (postElement) {
        postElement.classList.add("highlight-post");
        setTimeout(() => {
          postElement.classList.remove("highlight-post");
        }, 800);
      }
    })
    .catch(error => console.error("Error liking post:", error));
  }
</script>


<body class="show-page">

    <header>
        <img src="{{ url_for('static', filename='images/salmanac.png') }}" alt="Masterblog Banner" class="banner">
    </header>
    <br><br><br>

    <div class="header-bar">
        <div class="center">
            <a href="/" class="home-link">Home</a>
        </div>
        <br>
    </div>
    <br>


    <div class="filters">
    <a href="{{ url_for('show', sort='latest') }}" class="{% if sort == 'latest' %}active{% endif %}">Latest</a> |
    <a href="{{ url_for('show', sort='oldest') }}" class="{% if sort == 'oldest' %}active{% endif %}">Oldest</a> |
    <a href="{{ url_for('show', sort='likes') }}" class="{% if sort == 'likes' %}active{% endif %}">Most Liked</a>
</div>

<main>
  <div class="post-grid">
    {% for post in posts %}
        <article class="post" id="post-{{ post.id }}">
            <h3>{{ post.title }}</h3>
            <p><strong>By {{ post.author }}</strong>
            <p>{{ post.content }}</p>
            <p class="post-date">
    Created: {{ post.date }}
    {% if post.updated %} | Updated: {{ post.updated }}{% endif %}
</p>



            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                <div class="post-actions" style="display: flex; gap: 10px; align-items: center;">
    <!-- Update Button -->
    <form action="{{ url_for('update', post_id=post.id) }}" method="GET" style="display: inline;">
        <button type="submit">Update</button>
    </form>

    <!-- Delete Button -->
    <form action="{{ url_for('delete_blog', post_id=post.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this post?');" style="display: inline;">
        <button type="submit">üóë</button>
    </form>

    <!-- Like Button (AJAX) -->
    <form onsubmit="likePost(event, {{ post.id }})" style="display: inline;">
        <button type="submit" id="like-btn-{{ post.id }}">
            ‚ù§Ô∏è Like (<span id="like-count-{{ post.id }}">{{ post.likes }}</span>)
        </button>
    </form>
</div>

            </div>

            <hr>
        </article>
    {% else %}
        <p>No blog posts found.</p>
    {% endfor %}
  </div>
</main>

    <footer>
        &copy; The Quiet Almanac {{ 2025 }}
    </footer>

</body>
</html>
